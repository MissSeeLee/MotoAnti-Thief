<template>
  <div class="min-h-screen flex items-center justify-center bg-slate-100 p-4">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl shadow-slate-200/50 p-8 border border-slate-50 transition-all duration-500">
      
      <div v-if="isSuccess" class="text-center animate-fade-in-up">
        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <span class="text-4xl">üéâ</span>
        </div>
        <h2 class="text-2xl font-bold text-slate-800 mb-2">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
        <p class="text-slate-500 mb-6">
          ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß<br>
          ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Email ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö <span class="font-semibold text-slate-800">Username</span> ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        </p>
        <router-link 
          to="/login" 
          class="block w-full py-3.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold shadow-lg transition-all"
        >
          ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </router-link>
      </div>

      <div v-else>
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold text-slate-800">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà üöÄ</h2>
          <p class="text-slate-400 text-sm mt-1">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Moto-AntiThief ‡∏ü‡∏£‡∏µ</p>
        </div>

        <form @submit.prevent="register" class="space-y-4">
          
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</label>
            <input
              type="text"
              v-model="form.username"
              class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 text-slate-900 focus:border-blue-500 outline-none transition-all"
              placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"
              required
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input
              type="email"
              v-model="form.email"
              class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 text-slate-900 focus:border-blue-500 outline-none transition-all"
              placeholder="name@example.com"
              required
            />
          </div>

          <div>
  <label class="block text-sm font-medium text-slate-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
  <input
    type="tel"
    v-model="form.phone"
    @input="handlePhoneInput" 
    maxlength="10"
    class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-blue-500 outline-none transition-all"
    placeholder="08xxxxxxxx (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)"
    required
  />
</div>

          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input
              type="password"
              v-model="form.password"
              class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-blue-500 outline-none transition-all"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required
            />
          </div>

          <button
            type="submit"
            :disabled="isLoading"
            class="w-full py-3.5 bg-slate-900 hover:bg-slate-800 disabled:bg-slate-400 text-white rounded-xl font-semibold shadow-lg transition-all mt-4 flex justify-center items-center gap-2"
          >
            <span v-if="isLoading" class="loading loading-spinner loading-sm"></span>
            {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£' }}
          </button>
        </form>

        <div v-if="error" class="mt-4 p-3 bg-red-50 text-red-600 text-sm rounded-lg text-center border border-red-100">
          ‚ö†Ô∏è {{ error }}
        </div>

        <p class="text-center mt-6 text-sm text-slate-500">
          ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß?
          <router-link to="/login" class="text-slate-900 font-semibold hover:underline">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
          </router-link>
        </p>
      </div>

    </div>
  </div>
</template>

<script setup>
import { reactive, ref } from "vue";
import api from "../api";

// ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï form ‡πÉ‡∏´‡πâ‡∏°‡∏µ username
const form = reactive({ 
  username: "", 
  email: "", 
  phone: "", 
  password: "" 
});

const error = ref("");
const isSuccess = ref(false);
const isLoading = ref(false);

const register = async () => {
  error.value = "";
  isLoading.value = true;
  
  try {
    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á 4 ‡∏ï‡∏±‡∏ß‡πÑ‡∏õ Backend
    await api.post("/auth/register", form);
    
    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    isSuccess.value = true;
    
  } catch (e) {
    console.error("Register Error:", e);
    // ‡πÅ‡∏™‡∏î‡∏á Error ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Backend (‡πÄ‡∏ä‡πà‡∏ô "Username ‡∏ã‡πâ‡∏≥")
    error.value = e.response?.data?.error || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
  } finally {
    isLoading.value = false;
  }
};
const handlePhoneInput = (e) => {
  // 1. ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà User ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤
  let value = e.target.value;

  // 2. ‡πÉ‡∏ä‡πâ Regex ‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡∏Å (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏µ‡∏î, ‡∏ß‡∏£‡∏£‡∏Ñ, ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠)
  value = value.replace(/\D/g, '');

  // 3. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 10 ‡∏ï‡∏±‡∏ß ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á
  if (value.length > 10) {
    value = value.slice(0, 10);
  }

  // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
  form.phone = value;
  e.target.value = value;
};
</script>

<style scoped>
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-fade-in-up {
  animation: fadeInUp 0.5s ease-out;
}
</style>